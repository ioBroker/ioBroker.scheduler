import{j as r}from"./jsx-runtime-DJu4l8gT.js";import{v as g,R as k}from"./vis_mf_2_2_mf_2_scheduler__loadShare__react__loadShare__-j4bl0Obe.js";import{P as o}from"./vis_mf_2_2_mf_2_scheduler__loadShare__prop_mf_2_types__loadShare__-D_woRH77.js";import{v as p,a as N}from"./vis_mf_2_2_mf_2_scheduler__loadShare___mf_0_mui_mf_1_icons_mf_2_material__loadShare__-C5stKKBn.js";import{v as P,i as $}from"./vis_mf_2_2_mf_2_scheduler__mf_v__runtimeInit__mf_v__-DnslPhSa.js";import"./_commonjsHelpers-Cpj98o6Y.js";const{loadShare:F}=$,{initPromise:H}=P,q=H.then(a=>F("@iobroker/adapter-react-v5",{customShareInfo:{shareConfig:{singleton:!0,strictVersion:!1,requiredVersion:"*"}}})),J=await q.then(a=>a());var D=J;const U=""+new URL("day-night-CJgz3NQ1.jpg",import.meta.url).href,C={dayNightCont:{position:"relative",width:"100%",display:"flex",justifyContent:"center",overflow:"hidden",transition:"height 300ms ease-out","&>div":{position:"relative"},"&>div>.day_night":{width:"100%",maxWidth:550,maxHeight:90},"&>div>img":{width:"100%",maxWidth:550,height:"auto",maxHeight:90}},dayNightQuarter:{display:"flex",width:"100%"},dayNightSlide:{display:"flex",width:"100%",height:"calc(100% - 9px)",position:"absolute",border:"6px solid #FFF",mt:"-3px",transition:"all 400ms ease-out","&::before":{content:'""',position:"absolute",left:"calc(-200% - 5px)",top:-5,height:"calc(100% + 12px)",width:"200%",pointerEvents:"none",background:"linear-gradient(to left,  rgba(255,255,255,1) 0%,rgba(255,255,255,0) 99%,rgba(255,255,255,0) 100%)",filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#00ffffff',GradientType=0)"},"&::after":{content:'""',position:"absolute",right:"calc(-200% - 5px)",top:-5,height:"calc(100% + 12px)",width:"200%",pointerEvents:"none",background:"linear-gradient(to right,  rgba(255,255,255,1) 0%,rgba(255,255,255,0) 99%,rgba(255,255,255,0) 100%)",filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#00ffffff',GradientType=0)"}},dn:{width:"100%",maxWidth:550,maxHeight:90,height:"100%",position:"absolute",top:0,left:0,display:"flex"}};class T extends g.Component{onSlide=t=>{this.props.onChange&&this.props.onChange(t)};render(){const{sections:t}=this.props,e=t===1?0:78,s=100/t,i=Array(t).fill().map((n,l)=>r.jsx("div",{style:C.dayNightQuarter,onClick:()=>this.onSlide(l)},l));return r.jsx(p.Box,{sx:C.dayNightCont,style:{height:e},children:r.jsxs("div",{children:[r.jsx("img",{src:U,alt:"day-night",id:`${this.props.id}-day-night`}),r.jsxs("div",{style:C.dn,children:[i,r.jsx(p.Box,{sx:C.dayNightSlide,style:{maxWidth:`${s}%`,width:`${s}%`,left:`calc(${this.props.quarterId*s}% - 5px)`}})]})]})})}}T.propTypes={onChange:o.func,quarterId:o.number,sections:o.number,id:o.string.isRequired};const E={min:0,max:28,step:.5,unit:"Â°"},z={min:0,max:100,unit:"%"},A={min:0,max:1},u={temperature:E,percent:z,onoff:A},v={pretty:a=>({position:"relative",height:"100%",display:"flex",flexDirection:"column",width:a}),prettyLabel:{color:"#6c7a93",fontWeight:700,fontSize:".9rem",height:30,width:"calc(100% - 5px)",textAlign:"center"},prettyTime:{position:"absolute",fontSize:"0.9rem",fontWeight:700,bottom:27,width:"calc(100% - 5px)",borderRadius:"4px",height:28,maxHeight:28,minHeight:28,display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer"},active:a=>({backgroundColor:a.palette.primary.light,color:"#FFF"}),prettySecs:a=>({fontSize:"0.6rem",fontWeight:100,color:a.palette.text.primary}),tooltip:{pointerEvents:"none"}},f={root:(a,t)=>({color:a.palette.primary.light,borderRadius:0,transition:"all 100ms ease-out",position:"relative",width:`${t}px`,p:0,height:"calc(100% - 90px)"}),thumb:a=>({left:"50%",width:0,height:0,display:a==="onoff"?"none":"flex"}),active:{backgroundColor:"transparent",width:0,height:0},valueLabel:(a,t)=>({position:"relative",left:"unset",right:"unset",textAlign:"center",transform:"none !important",background:"transparent",userSelect:"none","& *":{userSelect:"none",background:"transparent",fontWeight:100,color:a.palette.text.primary,fontSize:t?`${t}px`:"1.0rem",transition:"all 100ms ease-out"}}),valueLabelCircle:{background:"transparent"},track:{transition:"all 100ms ease-out",borderRadius:"4px",width:"calc(100% - 8px)"},rail:a=>({transition:"all 100ms ease-out",borderRadius:"4px",height:"calc(100% + 5px)",mt:"-5px",backgroundColor:a.palette.primary.light,width:"calc(100% - 5px)",borderBottomLeftRadius:0,borderBottomRightRadius:0})};function W(a){const e=(W.canvas||(W.canvas=document.createElement("canvas"))).getContext("2d");return e.font="normal 1rem Roboto, Helvetica, Arial, sans-serif",e.measureText(a).width}const V=a=>{const t={...a},e=t.intervalsWidth;delete t.intervalsWidth,delete t.type,delete t.theme;const s=W(a.valueLabelFormat);let i;return s>e&&(i=Math.floor(e/s*13)),r.jsx(p.Slider,{id:a.id,sx:{"&.MuiSlider-root":f.root(a.theme,e),"& .MuiSlider-thumb":f.thumb(a.type),"& .MuiSlider-active":f.active,"& .MuiSlider-valueLabel":f.valueLabel(a.theme,i),"& .MuiSlider-valueLabelCircle":f.valueLabelCircle,"& .MuiSlider-track":f.track,"& .MuiSlider-rail":f.rail(a.theme)},...t})};class R extends g.Component{constructor(t){super(t),this.state={intervalsWidth:t.intervalsWidth},this.installed=!1}componentDidMount(){this.installHandlers()}componentWillUnmount(){const t=window.document.getElementById(`slider_${this.props.i}_${this.props.id}`);t&&(t.onmousemove=null)}installHandlers(){const t=window.document.getElementById(`slider_${this.props.i}_${this.props.id}`);t&&!this.installed&&(this.installed=!0,t._interval=this,t.onmousemove=function(e){var s,i;if((e.buttons||(s=e.touches)!=null&&s.length)&&e.shiftKey){const n=this._interval,l=this.getBoundingClientRect().height;let d;(i=e.touches)!=null&&i.length?d=e.touches[0].clientY-this.getBoundingClientRect().top:d=e.clientY-this.getBoundingClientRect().top;const{min:c,max:m}=n.getMinMax();let h;switch(n.props.type){case"temperature":h=d/l,h=c+Math.round((m-c)*(1-h)*2)/2,h=Math.min(m,Math.max(c,h));break;case"onoff":h=Math.round(d/l*100)<50;break;case"custom":h=d/l,h=c+Math.round((m-c)*(1-h)),h=Math.min(m,Math.max(c,h));break;case"percent":default:h=Math.round(d/l*100),h=100-h,h=Math.min(100,Math.max(0,h));break}n.props.on("data",h,n.props.i)}})}componentDidUpdate(t){this.installHandlers(),t.intervalsWidth!==this.props.intervalsWidth&&this.setState({intervalsWidth:this.props.intervalsWidth})}handleSliderChange=(t,e)=>{t.shiftKey||this.on("data",e)};handleSelected=t=>{t.shiftKey||this.on("selected",!this.props.selected)};on=(t,e)=>this.props.on&&this.props.on(t,e,this.props.i);getPostfix(t){switch(this.props.type){case"onoff":return t?r.jsx("span",{style:this.props.theme.palette.text.success,children:this.props.onText}):r.jsx("span",{style:this.props.theme.palette.text.danger,children:this.props.offText});case"custom":return this.props.minMax.marks&&this.props.minMax.marks[t]!==void 0?this.props.minMax.marks[t].toString():this.props.minMax.unit?t.toString()+this.props.minMax.unit:t.toString();case"percent":case"temperature":default:return t.toString()+this.props.minMax.unit}}getMinMax(){return this.props.type==="custom"?this.props.minMax:u[this.props.type]||{min:0,max:100}}getLabel=()=>{const{step:t,i:e}=this.props,s=e*t,i=parseInt(s),n=`0${s%1*60}`.slice(-2);return[i,n]};render(){const{value:t,i:e,selected:s,theme:i,type:n}=this.props,{intervalsWidth:l}=this.state;if(e<0)return"";const{min:d,max:c,step:m}=this.getMinMax();console.log("min",d,"max",c,"step",m);const h=this.getLabel(),w=t||0,S=n==="onoff"?this.getPostfix(w||0):"",j=n!=="onoff"?this.getPostfix(w||0):"";return r.jsx(p.Tooltip,{title:this.props.t('Press "shift" and move mouse to change more than one slider'),componentsProps:{popper:{sx:v.tooltip}},children:r.jsxs("span",{style:v.pretty(l),children:[r.jsx("span",{style:v.prettyLabel,children:S}),r.jsx(V,{ref:this.ref,theme:i,intervalsWidth:l,type:n,orientation:"vertical","aria-label":"pretty slider",value:w,valueLabelFormat:j,min:d,max:c,step:m||1,selected:s,onChange:this.handleSliderChange,valueLabelDisplay:"on",id:`slider_${this.props.i}_${this.props.id}`},e),r.jsxs(p.Box,{sx:s?v.active:void 0,onClick:this.handleSelected,onMouseMove:y=>{y.shiftKey&&y.buttons&&this.on("selected",window.myselectMode)},onMouseDown:y=>{y.shiftKey&&(window.myselectMode=!this.props.selected,this.on("selected",!this.props.selected))},style:{...v.prettyTime,userSelect:"none"},children:[r.jsx("span",{style:{color:this.props.theme.palette.text.primary},children:h[0]}),r.jsx(p.Box,{component:"span",sx:v.prettySecs,children:h[1]})]})]})})}}R.propTypes={i:o.number,intervalsWidth:o.number,on:o.func,selected:o.bool,step:o.number,theme:o.object,type:o.string,value:o.oneOfType([o.number,o.bool]),id:o.string.isRequired,minMax:o.object,offText:o.string,onText:o.string,t:o.func.isRequired};const I={swiperContent:{width:"100%",height:"100%",display:"flex",justifyContent:"space-between","@media (max-width:570px)":{justifyContent:"center"}},swiper:{width:"100%",height:"100%",display:"flex",alignItems:"center",marginTop:15,position:"relative"},timeLineContainer:{position:"absolute",height:"100%"},timeLine:a=>({zIndex:100,borderWidth:2,borderColor:a.palette.text.primary,borderLeftStyle:"dashed",width:4,height:"calc(100% - 20px)",position:"relative"})};class _ extends g.Component{timeInterval=null;setSlideInterval=null;constructor(t){super(t),this.state={slideId:0,selected:[],intervalsWidth:t.intervalsWidth,key:parseInt(Date.now()+Math.random()*1e3),currentTime:new Date},this.onText=t.t("on"),this.offText=t.t("off")}componentDidMount(){this.setSlideOfTime(),this.timeInterval=setInterval(()=>this.setState({currentTime:new Date}),1e3*120),this.setSlideInterval=setInterval(()=>this.setSlideOfTime(),1e3*120)}componentWillUnmount(){clearInterval(this.timeInterval),this.timeInterval=null,clearInterval(this.setSlideInterval),this.setSlideInterval=null}componentDidUpdate(t){t.range!==this.props.range&&(this.setState({slideId:0}),this.setSlideOfTime()),this.props.intervalsWidth&&t.intervalsWidth!==this.props.intervalsWidth&&this.setState({intervalsWidth:this.props.intervalsWidth,key:parseInt(Date.now()+Math.random()*1e3),slideId:this.getSlideOfTime(t.intervalsWidth)})}getNumberOfSectionsByRange=t=>{if(this.state.intervalsWidth>=720)return t===.25?4:t===.5?2:1;switch(t){case .25:return 16;case .5:return 8;case 1:return 4;case 2:return 3;case 4:return 1;case 3:default:return 2}};getCountByRange=(t,e)=>{if(e=e||this.state.intervalsWidth,e>=720)return t===.5||t===.25?24:_.getMaxByRange(t);switch(t){case .25:return 6;case .5:return 6;case 1:return 6;case 2:return 4;case 4:return 6;case 3:default:return 4}};static getMaxByRange=t=>24/t;setSlideId=t=>{this.setState({slideId:parseInt(t)})};onChange=(t,e,s)=>{const{selected:i}=this.state,n=JSON.parse(JSON.stringify(this.state));if(t==="selected")n[t][s]=e,this.setState(n);else if(t==="data"){const l=JSON.parse(JSON.stringify(this.props.data)),d=i[s];d||this.setState({selected:[]}),!d||i.filter(c=>c).length===0?l[s]=e:l.forEach((c,m)=>{i[m]&&(l[m]=e)}),this.props.onChange(l)}};getSlide(){const{intervalsWidth:t,slideId:e,selected:s,key:i}=this.state,{type:n,theme:l,range:d,data:c,minMax:m}=this.props,h=this.getCountByRange(d),w=_.getMaxByRange(d);if(e*h>=w)return setTimeout(()=>{this.setSlideOfTime()},50),null;const S=[];for(let b=e*h;b<(e+1)*h;b++)S.push(r.jsx(R,{value:c[b],selected:s[b],label:"",i:b,id:this.props.id,step:d,on:this.onChange,type:n,theme:l,intervalsWidth:t/h,minMax:m,onText:this.onText,offText:this.offText,t:this.props.t},`${b}step${d}${i}`));const j=new Date(this.state.currentTime),y=Math.round(((j.getHours()+j.getMinutes()/60)/d-h*e)/h*t);return r.jsxs(r.Fragment,{children:[r.jsx("div",{style:I.timeLineContainer,title:this.props.t("Now"),children:r.jsx(p.Box,{sx:I.timeLine,style:{left:y}})}),S]})}getSlideOfTime(t){const{range:e}=this.props;if(t=t||this.state.intervalsWidth,t){const s=new Date().getHours(),i=this.getCountByRange(e,t)*e;return Math.floor(s/i)}return 0}setSlideOfTime(){this.state.intervalsWidth&&this.setState({slideId:this.getSlideOfTime()})}render(){if(!this.state.intervalsWidth)return null;const{slideId:t}=this.state,{range:e}=this.props,s=this.getNumberOfSectionsByRange(e);return r.jsxs(r.Fragment,{children:[r.jsx(p.Box,{sx:I.swiperContent,children:r.jsx("div",{style:I.swiper,children:this.getSlide()})}),r.jsx(T,{id:this.props.id,sections:s,quarterId:parseInt(t),onChange:i=>{this.setSlideId(i),clearInterval(this.setSlideInterval),this.setSlideInterval=setInterval(()=>this.setSlideOfTime(),1e3*120)}})]})}}_.propTypes={data:o.array,intervalsWidth:o.number,onChange:o.func,range:o.number,theme:o.object,type:o.string,id:o.string.isRequired,minMax:o.object,t:o.func.isRequired};const O={tapperGrid:{margin:0,boxShadow:"none",borderRadius:0,alignItems:"center",p:"10px","@media (max-width:570px)":{margin:0,boxShadow:"none",borderRadius:0,alignItems:"center",padding:"0px 10px 0 60px"}},tapperInside:{overflow:"hidden",height:"100%",flexGrow:1,position:"relative",display:"flex",flexDirection:"column",justifyContent:"center"}};class L extends g.Component{constructor(t){super(t),this.tapperRef=k.createRef(),this.state={intervalsWidth:0}}componentDidMount(){window.addEventListener("resize",this.updateWindowDimensions),this.updateWindowDimensions()}componentDidUpdate(t){t.range!==this.props.range&&this.updateWindowDimensions(),t.windowWidth!==this.props.windowWidth&&this.updateWindowDimensions()}componentWillUnmount(){window.removeEventListener("resize",this.updateWindowDimensions)}updateWindowDimensions=()=>{var e;const t=(e=this.tapperRef.current)==null?void 0:e.getBoundingClientRect().width;this.setState({intervalsWidth:t||30})};render(){var d;const{type:t,theme:e,range:s,intervals:i,minMax:n}=this.props,l=(d=this.tapperRef.current)==null?void 0:d.getBoundingClientRect().width;return l&&l!==this.state.intervalsWidth&&(this.updateWidth=this.updateWidth||setTimeout(()=>{this.updateWidth=null,this.updateWindowDimensions()},100)),r.jsx(p.Box,{className:"m-1 h-100",sx:O.tapperGrid,style:{backgroundColor:e.palette.background.default,padding:0},children:r.jsx("div",{id:`${this.props.id}-tapper-inside`,ref:this.tapperRef,style:{...O.tapperInside,padding:0,width:"100%"},children:this.props.intervalsWidth||this.state.intervalsWidth?r.jsx(_,{id:this.props.id,data:i,onChange:this.props.onChange,theme:e,type:t,range:s,intervalsWidth:this.props.intervalsWidth||this.state.intervalsWidth,minMax:n,t:this.props.t}):null})})}}L.propTypes={intervals:o.array,onChange:o.func,range:o.number,theme:o.object,type:o.string,intervalsWidth:o.number,id:o.string.isRequired,minMax:o.object,t:o.func.isRequired};const G=["Su","Mo","Tu","We","Th","Fr","Sa"],K=[1,2,3,4,5,6,0],Q=[0,1,2,3,4,5,6],M={flow:{width:26,height:28,maxHeight:28,minHeight:28,padding:0,display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",position:"relative"},label:a=>({color:a.palette.text.primary,ml:0,mr:"12px"})};class B extends g.Component{render(){const t=this.props.firstDayOfWeek==="monday"?K:Q;return r.jsxs(p.FormControl,{component:"fieldset",style:{marginRight:12},children:[t.map(e=>r.jsx(p.FormControlLabel,{style:{marginLeft:6},control:r.jsx(p.Checkbox,{checked:this.props.dow.includes(e),color:"primary",style:M.flow,onChange:s=>this.props.onChange(e,s.target.checked)}),label:this.props.t(G[e]),sx:M.label},e)),this.props.holidayVisible?r.jsx(p.FormControlLabel,{style:{marginLeft:6},control:r.jsx(p.Checkbox,{checked:!!this.props.holiday,color:"primary",style:M.flow,onChange:e=>this.props.onChange("holiday",e.target.checked)}),label:this.props.t("Holiday"),sx:M.label}):null]})}}B.propTypes={dow:o.array,holiday:o.bool,holidayVisible:o.bool,onChange:o.func,firstDayOfWeek:o.string,t:o.func.isRequired};const X={content:{display:"flex",width:"100%",height:"100%",position:"relative"}},Y=a=>{const[t,e]=g.useState(null);if(g.useEffect(()=>{a.context.socket.getObject(`system.adapter.scheduler.${a.data.instance}`).then(n=>e(n))},[]),!t)return null;const s=[],i=(n,l)=>{n.forEach(d=>{s.push({profile:d,level:l}),t.native.profiles.filter(c=>c.parent===d.id).length&&i(t.native.profiles.filter(c=>c.parent===d.id),l+1)})};return i(t.native.profiles.filter(n=>!n.parent),0),console.log(s),r.jsx(p.Select,{style:{width:"100%"},value:a.data[a.field.name],onChange:n=>{const l={...a.data,[a.field.name]:n.target.value},d=s.find(m=>m.profile.id===a.data[a.field.name]),c=s.find(m=>m.profile.id===n.target.value);c&&(!l.name||d&&a.data.name===d.profile.title)&&(l.name=c.profile.title),a.setData(l)},variant:"standard",renderValue:n=>{const l=s.find(d=>d.profile.id===n);return r.jsx("div",{children:l?l.profile.title:""})},children:s.map(n=>r.jsx(p.MenuItem,{value:n.profile.id,disabled:n.profile.type==="folder",children:r.jsxs("div",{style:{paddingLeft:n.level*20,display:"flex"},children:[r.jsx("span",{style:{paddingRight:4},children:n.profile.type==="folder"?r.jsx(D.IconClosed,{}):r.jsx(N.Schedule,{})}),n.profile.title]})},n.profile.id))})};class x extends window.visRxWidget{static getWidgetInfo(){return{id:"tplScheduler",visSet:"scheduler",visWidgetLabel:"scheduler",visSetLabel:"set_label",visSetColor:"#70BBF7",visName:"Scheduler",visAttrs:[{name:"common",fields:[{label:"instance",name:"instance",type:"instance",adapter:"scheduler",isShort:!0},{label:"profile",name:"profile",type:"custom",hidden:t=>!t.instance&&t.instance!==0,component:(t,e,s,i)=>r.jsx(Y,{field:t,data:e,setData:s,context:i.context,selectedWidgets:i.selectedWidgets,selectedView:i.selectedView})},{label:"read_only",name:"readOnly",type:"checkbox",default:!1},{label:"hide_days_of_week",name:"hideDow",type:"checkbox",default:!1},{name:"noCard",label:"without_card",type:"checkbox",hidden:"!!data.externalDialog"},{name:"widgetTitle",label:"name",hidden:"!!data.noCard"}]}],visDefaultStyle:{width:"100%",height:355,position:"relative"},visPrev:"widgets/scheduler/img/prev_scheduler.png"}}static t(t,...e){return D.I18n.t(`scheduler_${t}`,...e)}constructor(t){super(t),this.widgetRef=k.createRef()}async propertiesUpdate(){const t=this.state.rxData.instance||this.state.rxData.instance===0?`system.adapter.scheduler.${this.state.rxData.instance}`:"";if(this.subscribedId!==t)if(this.subscribedId&&this.props.context.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged),this.subscribedId=t,this.subscribedId){const e=await this.props.context.socket.getObject(this.subscribedId),s=e.native.profiles.find(n=>n.id===this.state.rxData.profile),i={object:e};if(s){const n=s.data.type==="custom"?s.data.members[0]:"";if(n!==this.minMaxObjectId){this.minMaxObjectId=n;let l;this.minMaxObjectId?l=await this.props.context.socket.getObject(this.minMaxObjectId):l=null,i.minMaxObject=l}}await this.props.context.socket.subscribeObject(this.subscribedId,this.onProfileChanged),this.setState(i)}else this.setState({object:null});else if(this.state.object&&this.state.rxData.profile){const e=this.state.object.native.profiles.find(i=>i.id===this.state.rxData.profile),s=e.data.type==="custom"||e.data.type==="temperature"?e.data.members[0]:"";if(s!==this.minMaxObjectId){this.minMaxObjectId=s;let i;this.minMaxObjectId?i=await this.props.context.socket.getObject(this.minMaxObjectId):i=null,this.setState({minMaxObject:i})}}}componentDidMount(){super.componentDidMount(),this.propertiesUpdate()}componentWillUnmount(){super.componentWillUnmount(),this.subscribedId&&this.props.context.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged)}onProfileChanged=(t,e)=>{var s,i;if(t===this.state.object._id){const n=this.state.object.native.profiles.find(d=>d.id===this.state.rxData.profile),l=(i=(s=e.native)==null?void 0:s.profiles)==null?void 0:i.find(d=>d.id===this.state.rxData.profile);JSON.stringify(n)!==JSON.stringify(l)&&this.setState({object:e})}};onRxDataChanged(){this.propertiesUpdate()}getWidgetInfo(){return x.getWidgetInfo()}onDow=(t,e)=>{const s=JSON.parse(JSON.stringify(this.currentProfile()));t==="holiday"?s.holiday=e:e&&!s.dow.includes(t)?s.dow.push(t):!e&&s.dow.includes(t)&&s.dow.splice(s.dow.indexOf(t),1),this.changeProfile(s)};onIntervals=t=>{const e=JSON.parse(JSON.stringify(this.currentProfile()));e.intervals=t,this.changeProfile(e)};changeProfile=t=>{if(this.state.rxData.readOnly)return;const e=JSON.parse(JSON.stringify(this.state.object)),s=this.state.object.native.profiles.findIndex(i=>i.id===this.state.rxData.profile);e.native.profiles[s].data=t,this.setState({object:e}),this.writeTimeout?clearTimeout(this.writeTimeout):this.setState({writing:!0}),this.writeTimeout=setTimeout(async i=>{this.writeTimeout=null,await this.props.context.socket.setObject(i._id,i),this.setState({writing:!1})},2e3,e)};currentProfile=()=>{const t=this.state.object.native.profiles.find(e=>e.id===this.state.rxData.profile);return t?t.type==="profile"&&t.data:null};getProfileMinMax(t){var e,s;if(t.type==="custom"){const i=this.state.minMaxObject;if(((e=i==null?void 0:i.common)==null?void 0:e.type)==="number"){if(i.common.states&&!Array.isArray(i.common.states)){const n=Object.keys(i.common.states).map(l=>parseFloat(l)).sort();return{min:n[0],max:n[n.length-1],unit:i.common.unit,marks:i.common.states}}if(i.common.min!==void 0||i.common.max!==void 0)return{min:i.common.min!==void 0?i.common.min:0,max:i.common.max!==void 0?i.common.max:100,unit:i.common.unit,marks:null}}return{min:0,max:100,marks:null,unit:(s=i==null?void 0:i.common)==null?void 0:s.unit}}if(t.type==="temperature"){const i=this.state.minMaxObject;if(i!=null&&i.common&&(i.common.min!==void 0||i.common.max!==void 0))return{min:i.common.min!==void 0?i.common.min:u.temperature.min,max:i.common.max!==void 0?i.common.max:u.temperature.max,unit:i.common.unit||u[t.type].unit,marks:null}}return{min:u[t.type].min,max:u[t.type].max,step:u[t.type].step,marks:null,unit:u[t.type].unit}}renderWidgetBody(t){var n,l;if(super.renderWidgetBody(t),!this.state.rxData.instance)return r.jsx("div",{children:x.t("instance_not_selected")});if(!this.state.object)return null;console.log(this.state.object);const e=this.currentProfile();if(!e)return r.jsx("div",{children:x.t("profile_not_selected")});(n=this.widgetRef.current)!=null&&n.offsetWidth||setTimeout(()=>this.forceUpdate(),100);let s=(((l=this.widgetRef.current)==null?void 0:l.offsetWidth)||0)-(this.state.rxData.hideDow?0:80);s<0&&(s=0);const i=r.jsxs("div",{style:X.content,ref:this.widgetRef,children:[this.state.writing?r.jsx(p.LinearProgress,{style:{position:"absolute",zIndex:1,top:0,left:0,width:"100%"}}):null,s?r.jsx(L,{id:this.props.id,onChange:this.onIntervals,theme:this.props.context.theme,intervals:e.intervals,range:e.intervalDuration,type:e.type,socket:this.props.context.socket,windowWidth:s,readOnly:this.state.rxData.readOnly,intervalsWidth:s,minMax:this.getProfileMinMax(e),t:x.t}):null,this.state.rxData.hideDow&&s?null:r.jsx(B,{firstDayOfWeek:this.props.context.socket.systemConfig.common.firstDayOfWeek||"monday",readOnly:this.state.rxData.readOnly,dow:e.dow,holiday:e.holiday,holidayVisible:!!this.state.object.native.holidayId,onChange:this.onDow,theme:this.props.context.theme,t:x.t})]});return this.state.rxData.noCard||t.widget.usedInWidget?i:this.wrapContent(i,null,{height:"calc(100% - 24px)",width:"calc(100% - 50px)"})}}x.propTypes={context:o.object,themeType:o.string,style:o.object,data:o.object};export{x as default};
