"use strict";(self.webpackChunkiobroker_vis_2_widgets_scheduler=self.webpackChunkiobroker_vis_2_widgets_scheduler||[]).push([["src_Scheduler_jsx"],{54611:function(B,P,l){l.r(P);var p=l(4819),d=l.n(p),I=l(15854),h=l.n(I),v=l(58503),K=l.n(v),m=l(94427),N=l.n(m),y=l(59665),k=l.n(y),O=l(75606),J=l.n(O),g=l(88411),V=l.n(g),M=l(63682),W=l(93813),j=Object.defineProperty,w=Object.defineProperties,C=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,E=(n,t,e)=>t in n?j(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,x=(n,t)=>{for(var e in t||(t={}))R.call(t,e)&&E(n,e,t[e]);if(D)for(var e of D(t))S.call(t,e)&&E(n,e,t[e]);return n},U=(n,t)=>w(n,C(t)),_=(n,t,e)=>(E(n,typeof t!="symbol"?t+"":t,e),e),L=(n,t,e)=>new Promise((s,i)=>{var r=a=>{try{c(e.next(a))}catch(f){i(f)}},o=a=>{try{c(e.throw(a))}catch(f){i(f)}},c=a=>a.done?s(a.value):Promise.resolve(a.value).then(r,o);c((e=e.apply(n,t)).next())});const T=()=>({content:{display:"flex",width:"100%",height:"100%"}}),A=n=>{const[t,e]=(0,p.useState)(null);if((0,p.useEffect)(()=>{n.socket.getObject(`system.adapter.scheduler.${n.data.instance}`).then(r=>e(r))},[]),!t)return null;const s=[],i=(r,o)=>{r.forEach(c=>{s.push({profile:c,level:o}),t.native.profiles.filter(a=>a.parent===c.id).length&&i(t.native.profiles.filter(a=>a.parent===c.id),o+1)})};return i(t.native.profiles.filter(r=>!r.parent),0),console.log(s),d().createElement(m.Select,{style:{width:"100%"},value:n.data[n.field.name],onChange:r=>{const o=U(x({},n.data),{[n.field.name]:r.target.value}),c=s.find(f=>f.profile.id===n.data[n.field.name]),a=s.find(f=>f.profile.id===r.target.value);a&&(!o.name||c&&n.data.name===c.profile.title)&&(o.name=a.profile.title),n.setData(o)},variant:"standard",renderValue:r=>{const o=s.find(c=>c.profile.id===r);return d().createElement("div",null,o?o.profile.title:"")}},s.map(r=>d().createElement(m.MenuItem,{key:r.profile.id,value:r.profile.id,disabled:r.profile.type==="folder"},d().createElement("div",{style:{paddingLeft:r.level*20,display:"flex"}},d().createElement("span",{style:{paddingRight:4}},r.profile.type==="folder"?d().createElement(O.IconClosed,null):d().createElement(y.Schedule,null)),r.profile.title))))},b=window.visRxWidget||g.VisRxWidget;class u extends b{constructor(t){super(t),_(this,"onProfileChanged",(e,s)=>{var i,r;if(e===this.state.object._id){const o=this.state.object.native.profiles.find(a=>a.id===this.state.rxData.profile),c=(r=(i=s.native)==null?void 0:i.profiles)==null?void 0:r.find(a=>a.id===this.state.rxData.profile);JSON.stringify(o)!==JSON.stringify(c)&&this.setState({object:s})}}),_(this,"onDow",(e,s)=>{const i=JSON.parse(JSON.stringify(this.currentProfile()));s&&!i.dow.includes(e)?i.dow.push(e):!s&&i.dow.includes(e)&&i.dow.splice(i.dow.indexOf(e),1),this.changeProfile(i)}),_(this,"onIntervals",e=>{const s=JSON.parse(JSON.stringify(this.currentProfile()));s.intervals=e,this.changeProfile(s)}),_(this,"changeProfile",e=>{if(this.state.rxData.readOnly)return;const s=JSON.parse(JSON.stringify(this.state.object)),i=this.state.object.native.profiles.findIndex(r=>r.id===this.state.rxData.profile);s.native.profiles[i].data=e,this.setState({object:s}),this.props.socket.setObject(s._id,s)}),_(this,"currentProfile",()=>{const e=this.state.object.native.profiles.find(s=>s.id===this.state.rxData.profile);return e?e.type==="profile"&&e.data:null}),this.widgetRef=d().createRef()}static getWidgetInfo(){return{id:"tplScheduler",visSet:"scheduler",visWidgetLabel:"scheduler",visSetLabel:"set_label",visName:"Scheduler",visAttrs:[{name:"common",fields:[{label:"instance",name:"instance",type:"instance",adapter:"scheduler",isShort:!0},{label:"scheduler",name:"profile",type:"custom",hidden:t=>!t.instance&&t.instance!==0,component:(t,e,s,i)=>d().createElement(A,{field:t,data:e,setData:s,socket:i.socket,selectedWidgets:i.selectedWidgets,selectedView:i.selectedView,project:i.project,projectName:i.projectName,instance:i.instance,adapterName:i.adapterName})},{label:"read_only",name:"readOnly",type:"checkbox",default:!1},{label:"hide_days_of_week",name:"hideDow",type:"checkbox",default:!1},{label:"name",name:"name",tooltip:"used_only_with_relative",default:""}]}],visDefaultStyle:{width:"100%",height:355,position:"relative"},visPrev:"widgets/scheduler/img/prev_scheduler.png"}}propertiesUpdate(){return L(this,null,function*(){const t=yield this.props.socket.getObject(`system.adapter.scheduler.${this.state.rxData.instance}`);this.setState({object:t},()=>{this.subscribedId!==this.state.object._id&&(this.subscribedId&&this.props.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged),this.state.object._id?(this.subscribedId=this.state.object._id,this.props.socket.subscribeObject(this.state.object._id,this.onProfileChanged)):this.subscribedId=null)})})}componentDidMount(){super.componentDidMount(),this.propertiesUpdate()}componentWillUnmount(){super.componentWillUnmount(),this.subscribedId&&this.props.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged)}onRxDataChanged(){this.propertiesUpdate()}getWidgetInfo(){return u.getWidgetInfo()}renderWidgetBody(t){var e,s;if(super.renderWidgetBody(t),!this.state.rxData.instance)return d().createElement("div",null,O.I18n.t("Instance not selected"));if(!this.state.object)return null;console.log(this.state.object);const i=this.currentProfile();if(!i)return d().createElement("div",null,b.t("profile_not_selected"));(e=this.widgetRef.current)!=null&&e.offsetWidth||this.forceUpdate();let r=(((s=this.widgetRef.current)==null?void 0:s.offsetWidth)||0)-(this.state.rxData.hideDow?0:80);r<0&&(r=0);const o=d().createElement("div",{className:this.props.classes.content,ref:this.widgetRef},d().createElement(M.Z,{onChange:this.onIntervals,theme:this.props.theme,intervals:i.intervals,range:i.intervalDuration,type:i.type,socket:this.props.socket,windowWidth:r,readOnly:this.state.rxData.readOnly,intervalsWidth:r}),this.state.rxData.hideDow?null:d().createElement(W.Z,{firstDayOfWeek:this.props.socket.systemConfig.common.firstDayOfWeek||"monday",readOnly:this.state.rxData.readOnly,dow:i.dow,onChange:this.onDow,theme:this.props.theme}));return this.state.rxStyle.position==="relative"?this.wrapContent(o,null,{height:"calc(100% - 24px)",width:"calc(100% - 24px)"}):o}}u.propTypes={systemConfig:h().object,socket:h().object,themeType:h().string,style:h().object,data:h().object},P.default=(0,v.withStyles)(T)((0,v.withTheme)(u))}}]);

//# sourceMappingURL=src_Scheduler_jsx.a29126d0.chunk.js.map