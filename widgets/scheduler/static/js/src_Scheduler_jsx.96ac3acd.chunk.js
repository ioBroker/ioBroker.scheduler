"use strict";(self.webpackChunkiobroker_vis_2_widgets_scheduler=self.webpackChunkiobroker_vis_2_widgets_scheduler||[]).push([["src_Scheduler_jsx"],{54611:function(A,E,n){n.r(E);var p=n(4819),c=n.n(p),w=n(15854),_=n.n(w),v=n(58503),B=n.n(v),m=n(94427),K=n.n(m),y=n(75606),N=n.n(y),P=n(88411),k=n.n(P),M=n(63682),W=n(93813),I=Object.defineProperty,b=Object.defineProperties,j=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,O=(s,t,e)=>t in s?I(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,S=(s,t)=>{for(var e in t||(t={}))C.call(t,e)&&O(s,e,t[e]);if(g)for(var e of g(t))R.call(t,e)&&O(s,e,t[e]);return s},x=(s,t)=>b(s,j(t)),h=(s,t,e)=>(O(s,typeof t!="symbol"?t+"":t,e),e),U=(s,t,e)=>new Promise((r,i)=>{var a=o=>{try{d(e.next(o))}catch(f){i(f)}},l=o=>{try{d(e.throw(o))}catch(f){i(f)}},d=o=>o.done?r(o.value):Promise.resolve(o.value).then(a,l);d((e=e.apply(s,t)).next())});const L=()=>({}),T=s=>{const[t,e]=(0,p.useState)(null);if((0,p.useEffect)(()=>{s.socket.getObject(`system.adapter.scheduler.${s.data.instance}`).then(a=>e(a))},[]),!t)return null;const r=[],i=(a,l)=>{a.forEach(d=>{r.push({profile:d,level:l}),t.native.profiles.filter(o=>o.parent===d.id).length&&i(t.native.profiles.filter(o=>o.parent===d.id),l+1)})};return i(t.native.profiles.filter(a=>!a.parent),0),console.log(r),c().createElement(m.Select,{style:{width:"100%"},value:s.data[s.field.name],onChange:a=>{const l=x(S({},s.data),{[s.field.name]:a.target.value}),d=r.find(f=>f.profile.id===s.data[s.field.name]),o=r.find(f=>f.profile.id===a.target.value);o&&(!l.name||d&&s.data.name===d.profile.title)&&(l.name=o.profile.title),s.setData(l)},variant:"standard",renderValue:a=>{const l=r.find(d=>d.profile.id===a);return c().createElement("div",null,l?l.profile.title:"")}},r.map(a=>c().createElement(m.MenuItem,{key:a.profile.id,value:a.profile.id},c().createElement("div",{style:{paddingLeft:a.level*20}},a.profile.title))))},D=window.visRxWidget||P.VisRxWidget;class u extends D{constructor(t){super(t),h(this,"onDow",(e,r)=>{const i=JSON.parse(JSON.stringify(this.currentProfile()));r&&!i.dow.includes(e)?i.dow.push(e):!r&&i.dow.includes(e)&&i.dow.splice(i.dow.indexOf(e),1),this.changeProfile(i)}),h(this,"onIntervals",e=>{const r=JSON.parse(JSON.stringify(this.currentProfile()));r.intervals=e,this.changeProfile(r)}),h(this,"changeProfile",e=>{if(this.state.rxData.readOnly)return;const r=JSON.parse(JSON.stringify(this.state.object)),i=this.state.object.native.profiles.findIndex(a=>a.id===this.state.rxData.profile);r.native.profiles[i].data=e,this.setState({object:r}),this.props.socket.setObject(r._id,r)}),h(this,"currentProfile",()=>{const e=this.state.object.native.profiles.find(r=>r.id===this.state.rxData.profile);return e?e.type==="profile"&&e.data:null}),this.widgetRef=c().createRef()}static getWidgetInfo(){return{id:"tplScheduler",visSet:"scheduler",visWidgetLabel:"scheduler",visSetLabel:"set_label",visName:"Scheduler",visAttrs:[{name:"common",fields:[{label:"instance",name:"instance",type:"instance",adapter:"scheduler",isShort:!0},{label:"scheduler",name:"profile",type:"custom",hidden:t=>!t.instance&&t.instance!==0,component:(t,e,r,i)=>c().createElement(T,{field:t,data:e,setData:r,socket:i.socket,selectedWidgets:i.selectedWidgets,selectedView:i.selectedView,project:i.project,projectName:i.projectName,instance:i.instance,adapterName:i.adapterName})},{label:"read_only",name:"readOnly",type:"checkbox",default:!1},{label:"hide_days_of_week",name:"hideDow",type:"checkbox",default:!1},{label:"name",name:"name",tooltip:"used_only_with_relative",default:""}]}],visDefaultStyle:{width:"100%",height:120,position:"relative"},visPrev:"widgets/scheduler/img/prev_scheduler.png"}}propertiesUpdate(){return U(this,null,function*(){const t=yield this.props.socket.getObject(`system.adapter.scheduler.${this.state.rxData.instance}`);this.setState({object:t})})}componentDidMount(){super.componentDidMount(),this.propertiesUpdate()}onRxDataChanged(){this.propertiesUpdate()}getWidgetInfo(){return u.getWidgetInfo()}renderWidgetBody(t){var e,r;if(super.renderWidgetBody(t),!this.state.rxData.instance)return c().createElement("div",null,y.I18n.t("Instance not selected"));if(!this.state.object)return null;console.log(this.state.object);const i=this.currentProfile();if(!i)return c().createElement("div",null,D.t("profile_not_selected"));(e=this.widgetRef.current)!=null&&e.offsetWidth||this.forceUpdate();let a=(((r=this.widgetRef.current)==null?void 0:r.offsetWidth)||0)-80;a<0&&(a=0);const l=c().createElement("div",{style:{display:"flex",width:"100%",height:"100%"},ref:this.widgetRef},c().createElement(M.Z,{onChange:this.onIntervals,theme:this.props.theme,intervals:i.intervals,range:i.intervalDuration,type:i.type,socket:this.props.socket,windowWidth:a,readOnly:this.state.rxData.readOnly,intervalsWidth:a}),this.state.rxData.hideDow?null:c().createElement(W.Z,{firstDayOfWeek:this.props.socket.systemConfig.common.firstDayOfWeek||"monday",readOnly:this.state.rxData.readOnly,dow:i.dow,onChange:this.onDow,theme:this.props.theme}));return this.state.rxStyle.position==="relative"?this.wrapContent(l,null,{height:"calc(100% - 24px)",width:"calc(100% - 24px)"}):l}}u.propTypes={systemConfig:_().object,socket:_().object,themeType:_().string,style:_().object,data:_().object},E.default=(0,v.withStyles)(L)((0,v.withTheme)(u))}}]);

//# sourceMappingURL=src_Scheduler_jsx.96ac3acd.chunk.js.map