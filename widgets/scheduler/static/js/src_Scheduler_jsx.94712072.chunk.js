"use strict";(self.webpackChunkiobroker_vis_2_widgets_gauges=self.webpackChunkiobroker_vis_2_widgets_gauges||[]).push([["src_Scheduler_jsx"],{54611:function(A,E,a){a.r(E);var u=a(4819),l=a.n(u),y=a(15854),f=a.n(y),p=a(58503),B=a.n(p),v=a(94427),K=a.n(v),P=a(75606),N=a.n(P),D=a(73686),M=a(63682),W=a(93813),I=Object.defineProperty,j=Object.defineProperties,w=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,m=(n,t,e)=>t in n?I(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,S=(n,t)=>{for(var e in t||(t={}))b.call(t,e)&&m(n,e,t[e]);if(g)for(var e of g(t))C.call(t,e)&&m(n,e,t[e]);return n},R=(n,t)=>j(n,w(t)),h=(n,t,e)=>(m(n,typeof t!="symbol"?t+"":t,e),e),U=(n,t,e)=>new Promise((s,r)=>{var i=o=>{try{c(e.next(o))}catch(O){r(O)}},d=o=>{try{c(e.throw(o))}catch(O){r(O)}},c=o=>o.done?s(o.value):Promise.resolve(o.value).then(i,d);c((e=e.apply(n,t)).next())});const L=()=>({}),T=n=>{const[t,e]=(0,u.useState)(null);if((0,u.useEffect)(()=>{n.socket.getObject(`system.adapter.scheduler.${n.data.instance}`).then(i=>e(i))},[]),!t)return null;const s=[],r=(i,d)=>{i.forEach(c=>{s.push({profile:c,level:d}),t.native.profiles.filter(o=>o.parent===c.id).length&&r(t.native.profiles.filter(o=>o.parent===c.id),d+1)})};return r(t.native.profiles.filter(i=>!i.parent),0),console.log(s),l().createElement(v.Select,{value:n.data[n.field.name],onChange:i=>n.setData(R(S({},n.data),{[n.field.name]:i.target.value})),variant:"standard",renderValue:i=>{const d=s.find(c=>c.profile.id===i);return l().createElement("div",null,d?d.profile.title:"")}},s.map(i=>l().createElement(v.MenuItem,{key:i.profile.id,value:i.profile.id},l().createElement("div",{style:{paddingLeft:i.level*20}},i.profile.title))))};class _ extends D.Z{constructor(t){super(t),h(this,"onDow",(e,s)=>{const r=JSON.parse(JSON.stringify(this.currentProfile()));s&&!r.dow.includes(e)?r.dow.push(e):!s&&r.dow.includes(e)&&r.dow.splice(r.dow.indexOf(e),1),this.changeProfile(r)}),h(this,"onIntervals",e=>{const s=JSON.parse(JSON.stringify(this.currentProfile()));s.intervals=e,this.changeProfile(s)}),h(this,"changeProfile",e=>{if(this.state.rxData.readOnly)return;const s=JSON.parse(JSON.stringify(this.state.object)),r=this.state.object.native.profiles.findIndex(i=>i.id===this.state.rxData.profile);s.native.profiles[r].data=e,this.setState({object:s}),this.props.socket.setObject(s._id,s)}),h(this,"currentProfile",()=>{const e=this.state.object.native.profiles.find(s=>s.id===this.state.rxData.profile);return e?e.type==="profile"&&e.data:null}),this.widgetRef=l().createRef()}static getWidgetInfo(){return{id:"tplScheduler",visSet:"scheduler",visWidgetLabel:"scheduler",visSetLabel:"set_label",visName:"Scheduler",visAttrs:[{name:"common",fields:[{label:"Instance",name:"instance",type:"instance",adapter:"scheduler",isShort:!0},{label:"Scheduler",name:"profile",type:"custom",hidden:t=>!t.instance&&t.instance!==0,component:(t,e,s,r)=>l().createElement(T,{field:t,data:e,setData:s,socket:r.socket,selectedWidgets:r.selectedWidgets,selectedView:r.selectedView,project:r.project,projectName:r.projectName,instance:r.instance,adapterName:r.adapterName})},{label:"Read only",name:"readOnly",type:"checkbox",default:!1}]}],visDefaultStyle:{width:"100%",height:120,position:"relative"},visPrev:"widgets/scheduler/img/prev_scheduler.png"}}propertiesUpdate(){return U(this,null,function*(){const t=yield this.props.socket.getObject(`system.adapter.scheduler.${this.state.rxData.instance}`);this.setState({object:t})})}componentDidMount(){super.componentDidMount(),this.propertiesUpdate()}onRxDataChanged(){this.propertiesUpdate()}getWidgetInfo(){return _.getWidgetInfo()}renderWidgetBody(t){var e,s;if(super.renderWidgetBody(t),!this.state.object)return null;console.log(this.state.object);const r=this.currentProfile();if(!r)return l().createElement("div",null,P.I18n.t("Profile not selected"));(e=this.widgetRef.current)!=null&&e.offsetWidth||this.forceUpdate();let i=(((s=this.widgetRef.current)==null?void 0:s.offsetWidth)||0)-80;return i<0&&(i=0),l().createElement("div",{style:{display:"flex",width:"100%",height:"100%"},ref:this.widgetRef},l().createElement(M.Z,{onChange:this.onIntervals,theme:this.props.theme,intervals:r.intervals,range:r.intervalDuration,type:r.type,socket:this.props.socket,windowWidth:i,intervalsWidth:i}),l().createElement(W.Z,{firstDayOfWeek:this.props.socket.systemConfig.common.firstDayOfWeek||"monday",dow:r.dow,onChange:this.onDow,theme:this.props.theme}))}}_.propTypes={systemConfig:f().object,socket:f().object,themeType:f().string,style:f().object,data:f().object},E.default=(0,p.withStyles)(L)((0,p.withTheme)(_))}}]);

//# sourceMappingURL=src_Scheduler_jsx.94712072.chunk.js.map