"use strict";(self.webpackChunkiobroker_vis_2_widgets_scheduler=self.webpackChunkiobroker_vis_2_widgets_scheduler||[]).push([["src_Scheduler_jsx"],{54611:function(A,P,l){l.r(P);var p=l(4819),d=l.n(p),b=l(15854),_=l.n(b),v=l(58503),K=l.n(v),m=l(94427),N=l.n(m),D=l(59665),k=l.n(D),O=l(75606),J=l.n(O),y=l(88411),V=l.n(y),I=l(63682),M=l(93813),W=Object.defineProperty,w=Object.defineProperties,C=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,E=(r,t,e)=>t in r?W(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,R=(r,t)=>{for(var e in t||(t={}))j.call(t,e)&&E(r,e,t[e]);if(g)for(var e of g(t))x.call(t,e)&&E(r,e,t[e]);return r},S=(r,t)=>w(r,C(t)),u=(r,t,e)=>(E(r,typeof t!="symbol"?t+"":t,e),e),U=(r,t,e)=>new Promise((s,i)=>{var n=a=>{try{c(e.next(a))}catch(h){i(h)}},o=a=>{try{c(e.throw(a))}catch(h){i(h)}},c=a=>a.done?s(a.value):Promise.resolve(a.value).then(n,o);c((e=e.apply(r,t)).next())});const B=()=>({content:{display:"flex",width:"100%",height:"100%"}}),L=r=>{const[t,e]=(0,p.useState)(null);if((0,p.useEffect)(()=>{r.socket.getObject(`system.adapter.scheduler.${r.data.instance}`).then(n=>e(n))},[]),!t)return null;const s=[],i=(n,o)=>{n.forEach(c=>{s.push({profile:c,level:o}),t.native.profiles.filter(a=>a.parent===c.id).length&&i(t.native.profiles.filter(a=>a.parent===c.id),o+1)})};return i(t.native.profiles.filter(n=>!n.parent),0),console.log(s),d().createElement(m.Select,{style:{width:"100%"},value:r.data[r.field.name],onChange:n=>{const o=S(R({},r.data),{[r.field.name]:n.target.value}),c=s.find(h=>h.profile.id===r.data[r.field.name]),a=s.find(h=>h.profile.id===n.target.value);a&&(!o.name||c&&r.data.name===c.profile.title)&&(o.name=a.profile.title),r.setData(o)},variant:"standard",renderValue:n=>{const o=s.find(c=>c.profile.id===n);return d().createElement("div",null,o?o.profile.title:"")}},s.map(n=>d().createElement(m.MenuItem,{key:n.profile.id,value:n.profile.id,disabled:n.profile.type==="folder"},d().createElement("div",{style:{paddingLeft:n.level*20,display:"flex"}},d().createElement("span",{style:{paddingRight:4}},n.profile.type==="folder"?d().createElement(O.IconClosed,null):d().createElement(D.Schedule,null)),n.profile.title))))},T=window.visRxWidget||y.VisRxWidget;class f extends T{constructor(t){super(t),u(this,"onProfileChanged",(e,s)=>{var i,n;if(e===this.state.object._id){const o=this.state.object.native.profiles.find(a=>a.id===this.state.rxData.profile),c=(n=(i=s.native)==null?void 0:i.profiles)==null?void 0:n.find(a=>a.id===this.state.rxData.profile);JSON.stringify(o)!==JSON.stringify(c)&&this.setState({object:s})}}),u(this,"onDow",(e,s)=>{const i=JSON.parse(JSON.stringify(this.currentProfile()));s&&!i.dow.includes(e)?i.dow.push(e):!s&&i.dow.includes(e)&&i.dow.splice(i.dow.indexOf(e),1),this.changeProfile(i)}),u(this,"onIntervals",e=>{const s=JSON.parse(JSON.stringify(this.currentProfile()));s.intervals=e,this.changeProfile(s)}),u(this,"changeProfile",e=>{if(this.state.rxData.readOnly)return;const s=JSON.parse(JSON.stringify(this.state.object)),i=this.state.object.native.profiles.findIndex(n=>n.id===this.state.rxData.profile);s.native.profiles[i].data=e,this.setState({object:s}),this.props.socket.setObject(s._id,s)}),u(this,"currentProfile",()=>{const e=this.state.object.native.profiles.find(s=>s.id===this.state.rxData.profile);return e?e.type==="profile"&&e.data:null}),this.widgetRef=d().createRef()}static getWidgetInfo(){return{id:"tplScheduler",visSet:"scheduler",visWidgetLabel:"scheduler",visSetLabel:"set_label",visSetColor:"#70BBF7",visName:"Scheduler",visAttrs:[{name:"common",fields:[{label:"instance",name:"instance",type:"instance",adapter:"scheduler",isShort:!0},{label:"scheduler",name:"profile",type:"custom",hidden:t=>!t.instance&&t.instance!==0,component:(t,e,s,i)=>d().createElement(L,{field:t,data:e,setData:s,socket:i.socket,selectedWidgets:i.selectedWidgets,selectedView:i.selectedView,project:i.project,projectName:i.projectName,instance:i.instance,adapterName:i.adapterName})},{label:"read_only",name:"readOnly",type:"checkbox",default:!1},{label:"hide_days_of_week",name:"hideDow",type:"checkbox",default:!1},{label:"name",name:"name",tooltip:"used_only_with_relative",default:""}]}],visDefaultStyle:{width:"100%",height:355,position:"relative"},visPrev:"widgets/scheduler/img/prev_scheduler.png"}}static t(t,...e){return O.I18n.t(`scheduler_${t}`,...e)}propertiesUpdate(){return U(this,null,function*(){const t=this.state.rxData.instance||this.state.rxData.instance===0?`system.adapter.scheduler.${this.state.rxData.instance}`:"";if(this.subscribedId!==t&&(this.subscribedId&&this.props.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged),this.subscribedId=null),t){const e=yield this.props.socket.getObject(t);this.setState({object:e},()=>{!this.subscribedId&&e&&t&&(this.subscribedId=t,this.props.socket.subscribeObject(t,this.onProfileChanged))})}else this.setState({object:null})})}componentDidMount(){super.componentDidMount(),this.propertiesUpdate()}componentWillUnmount(){super.componentWillUnmount(),this.subscribedId&&this.props.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged)}onRxDataChanged(){this.propertiesUpdate()}getWidgetInfo(){return f.getWidgetInfo()}renderWidgetBody(t){var e,s;if(super.renderWidgetBody(t),!this.state.rxData.instance)return d().createElement("div",null,f.t("instance_not_selected"));if(!this.state.object)return null;console.log(this.state.object);const i=this.currentProfile();if(!i)return d().createElement("div",null,f.t("profile_not_selected"));(e=this.widgetRef.current)!=null&&e.offsetWidth||this.forceUpdate();let n=(((s=this.widgetRef.current)==null?void 0:s.offsetWidth)||0)-(this.state.rxData.hideDow?0:80);n<0&&(n=0);const o=d().createElement("div",{className:this.props.classes.content,ref:this.widgetRef},d().createElement(I.Z,{onChange:this.onIntervals,theme:this.props.theme,intervals:i.intervals,range:i.intervalDuration,type:i.type,socket:this.props.socket,windowWidth:n,readOnly:this.state.rxData.readOnly,intervalsWidth:n}),this.state.rxData.hideDow?null:d().createElement(M.Z,{firstDayOfWeek:this.props.socket.systemConfig.common.firstDayOfWeek||"monday",readOnly:this.state.rxData.readOnly,dow:i.dow,onChange:this.onDow,theme:this.props.theme,t:f.t}));return this.state.rxStyle.position==="relative"?this.wrapContent(o,null,{height:"calc(100% - 24px)",width:"calc(100% - 24px)"}):o}}f.propTypes={systemConfig:_().object,socket:_().object,themeType:_().string,style:_().object,data:_().object},P.default=(0,v.withStyles)(B)((0,v.withTheme)(f))}}]);

//# sourceMappingURL=src_Scheduler_jsx.b76edcb3.chunk.js.map