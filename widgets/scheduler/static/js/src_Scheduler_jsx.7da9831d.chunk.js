"use strict";(self.webpackChunkiobroker_vis_2_widgets_scheduler=self.webpackChunkiobroker_vis_2_widgets_scheduler||[]).push([["src_Scheduler_jsx"],{44028:function(e,t,n){n.r(t);var i=n(74165),r=n(15861),a=n(15671),s=n(43144),o=n(11752),c=n(61120),l=n(60136),d=n(27277),u=n(4942),f=n(1413),h=n(29439),p=n(4819),m=n.n(p),x=n(15854),v=n.n(x),b=n(12181),y=n(94427),g=n(59665),j=n(75606),k=n(88411),w=n(68143),O=n(69438),D=n(39044),I=n(80184),S=function(e){var t=(0,p.useState)(null),n=(0,h.Z)(t,2),i=n[0],r=n[1];if((0,p.useEffect)((function(){e.context.socket.getObject("system.adapter.scheduler.".concat(e.data.instance)).then((function(e){return r(e)}))}),[]),!i)return null;var a=[];return function e(t,n){t.forEach((function(t){a.push({profile:t,level:n}),i.native.profiles.filter((function(e){return e.parent===t.id})).length&&e(i.native.profiles.filter((function(e){return e.parent===t.id})),n+1)}))}(i.native.profiles.filter((function(e){return!e.parent})),0),console.log(a),(0,I.jsx)(y.Select,{style:{width:"100%"},value:e.data[e.field.name],onChange:function(t){var n=(0,f.Z)((0,f.Z)({},e.data),{},(0,u.Z)({},e.field.name,t.target.value)),i=a.find((function(t){return t.profile.id===e.data[e.field.name]})),r=a.find((function(e){return e.profile.id===t.target.value}));r&&(!n.name||i&&e.data.name===i.profile.title)&&(n.name=r.profile.title),e.setData(n)},variant:"standard",renderValue:function(e){var t=a.find((function(t){return t.profile.id===e}));return(0,I.jsx)("div",{children:t?t.profile.title:""})},children:a.map((function(e){return(0,I.jsx)(y.MenuItem,{value:e.profile.id,disabled:"folder"===e.profile.type,children:(0,I.jsxs)("div",{style:{paddingLeft:20*e.level,display:"flex"},children:[(0,I.jsx)("span",{style:{paddingRight:4},children:"folder"===e.profile.type?(0,I.jsx)(j.IconClosed,{}):(0,I.jsx)(g.Schedule,{})}),e.profile.title]})},e.profile.id)}))})},_=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(e){var s;return(0,a.Z)(this,n),(s=t.call(this,e)).onProfileChanged=function(e,t){if(e===s.state.object._id){var n,i,r=s.state.object.native.profiles.find((function(e){return e.id===s.state.rxData.profile})),a=null===(n=t.native)||void 0===n||null===(i=n.profiles)||void 0===i?void 0:i.find((function(e){return e.id===s.state.rxData.profile}));JSON.stringify(r)!==JSON.stringify(a)&&s.setState({object:t})}},s.onDow=function(e,t){var n=JSON.parse(JSON.stringify(s.currentProfile()));t&&!n.dow.includes(e)?n.dow.push(e):!t&&n.dow.includes(e)&&n.dow.splice(n.dow.indexOf(e),1),s.changeProfile(n)},s.onIntervals=function(e){var t=JSON.parse(JSON.stringify(s.currentProfile()));t.intervals=e,s.changeProfile(t)},s.changeProfile=function(e){if(!s.state.rxData.readOnly){var t=JSON.parse(JSON.stringify(s.state.object)),n=s.state.object.native.profiles.findIndex((function(e){return e.id===s.state.rxData.profile}));t.native.profiles[n].data=e,s.setState({object:t}),s.writeTimeout?clearTimeout(s.writeTimeout):s.setState({writing:!0}),s.writeTimeout=setTimeout(function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.writeTimeout=null,e.next=3,s.props.context.socket.setObject(t._id,t);case 3:s.setState({writing:!1});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),2e3,t)}},s.currentProfile=function(){var e=s.state.object.native.profiles.find((function(e){return e.id===s.state.rxData.profile}));return e?"profile"===e.type&&e.data:null},s.widgetRef=m().createRef(),s}return(0,s.Z)(n,[{key:"propertiesUpdate",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(){var t,n,r,a,s,o,c,l,d,u=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state.rxData.instance||0===this.state.rxData.instance?"system.adapter.scheduler.".concat(this.state.rxData.instance):"",this.subscribedId===t){e.next=30;break}if(this.subscribedId&&this.props.context.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged),this.subscribedId=t,!this.subscribedId){e.next=27;break}return e.next=7,this.props.context.socket.getObject(this.subscribedId);case 7:if(n=e.sent,r=n.native.profiles.find((function(e){return e.id===u.state.rxData.profile})),a={object:n},!r){e.next=22;break}if((s="custom"===r.data.type?r.data.members[0]:"")===this.minMaxObjectId){e.next=22;break}if(this.minMaxObjectId=s,!this.minMaxObjectId){e.next=20;break}return e.next=17,this.props.context.socket.getObject(this.minMaxObjectId);case 17:o=e.sent,e.next=21;break;case 20:o=null;case 21:a.minMaxObject=o;case 22:return e.next=24,this.props.context.socket.subscribeObject(this.subscribedId,this.onProfileChanged);case 24:this.setState(a),e.next=28;break;case 27:this.setState({object:null});case 28:e.next=43;break;case 30:if(!this.state.object||!this.state.rxData.profile){e.next=43;break}if(c=this.state.object.native.profiles.find((function(e){return e.id===u.state.rxData.profile})),(l="custom"===c.data.type||"temperature"===c.data.type?c.data.members[0]:"")===this.minMaxObjectId){e.next=43;break}if(this.minMaxObjectId=l,!this.minMaxObjectId){e.next=41;break}return e.next=38,this.props.context.socket.getObject(this.minMaxObjectId);case 38:d=e.sent,e.next=42;break;case 41:d=null;case 42:this.setState({minMaxObject:d});case 43:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){(0,o.Z)((0,c.Z)(n.prototype),"componentDidMount",this).call(this),this.propertiesUpdate()}},{key:"componentWillUnmount",value:function(){(0,o.Z)((0,c.Z)(n.prototype),"componentWillUnmount",this).call(this),this.subscribedId&&this.props.context.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged)}},{key:"onRxDataChanged",value:function(){this.propertiesUpdate()}},{key:"getWidgetInfo",value:function(){return n.getWidgetInfo()}},{key:"getProfileMinMax",value:function(e){if("custom"===e.type){var t,n,i=this.state.minMaxObject;if("number"===(null===i||void 0===i||null===(t=i.common)||void 0===t?void 0:t.type)){if(i.common.states&&!Array.isArray(i.common.states)){var r=Object.keys(i.common.states).map((function(e){return parseFloat(e)})).sort();return{min:r[0],max:r[r.length-1],unit:i.common.unit,marks:i.common.states}}if(void 0!==i.common.min||void 0!==i.common.max)return{min:void 0!==i.common.min?i.common.min:0,max:void 0!==i.common.max?i.common.max:100,unit:i.common.unit,marks:null}}return{min:0,max:100,marks:null,unit:null===i||void 0===i||null===(n=i.common)||void 0===n?void 0:n.unit}}if("temperature"===e.type){var a=this.state.minMaxObject;if(null!==a&&void 0!==a&&a.common&&(void 0!==a.common.min||void 0!==a.common.max))return{min:void 0!==a.common.min?a.common.min:D.temperature.min,max:void 0!==a.common.max?a.common.max:D.temperature.max,unit:a.common.unit||D[e.type].unit,marks:null}}return{min:D[e.type].min,max:D[e.type].max,step:D[e.type].step,marks:null,unit:D[e.type].unit}}},{key:"renderWidgetBody",value:function(e){var t,i,r=this;if((0,o.Z)((0,c.Z)(n.prototype),"renderWidgetBody",this).call(this,e),!this.state.rxData.instance)return(0,I.jsx)("div",{children:n.t("instance_not_selected")});if(!this.state.object)return null;console.log(this.state.object);var a=this.currentProfile();if(!a)return(0,I.jsx)("div",{children:n.t("profile_not_selected")});null!==(t=this.widgetRef.current)&&void 0!==t&&t.offsetWidth||setTimeout((function(){return r.forceUpdate()}),100);var s=((null===(i=this.widgetRef.current)||void 0===i?void 0:i.offsetWidth)||0)-(this.state.rxData.hideDow?0:80);s<0&&(s=0);var l=(0,I.jsxs)("div",{className:this.props.classes.content,ref:this.widgetRef,children:[this.state.writing?(0,I.jsx)(y.LinearProgress,{style:{position:"absolute",zIndex:1,top:0,left:0,width:"100%"}}):null,s?(0,I.jsx)(w.Z,{id:this.props.id,onChange:this.onIntervals,theme:this.props.theme,intervals:a.intervals,range:a.intervalDuration,type:a.type,socket:this.props.context.socket,windowWidth:s,readOnly:this.state.rxData.readOnly,intervalsWidth:s,minMax:this.getProfileMinMax(a)}):null,this.state.rxData.hideDow&&s?null:(0,I.jsx)(O.Z,{firstDayOfWeek:this.props.context.socket.systemConfig.common.firstDayOfWeek||"monday",readOnly:this.state.rxData.readOnly,dow:a.dow,onChange:this.onDow,theme:this.props.theme,t:n.t})]});return this.state.rxData.noCard||e.widget.usedInWidget?l:this.wrapContent(l,null,{height:"calc(100% - 24px)",width:"calc(100% - 24px)"})}}],[{key:"getWidgetInfo",value:function(){return{id:"tplScheduler",visSet:"scheduler",visWidgetLabel:"scheduler",visSetLabel:"set_label",visSetColor:"#70BBF7",visName:"Scheduler",visAttrs:[{name:"common",fields:[{label:"instance",name:"instance",type:"instance",adapter:"scheduler",isShort:!0},{label:"profile",name:"profile",type:"custom",hidden:function(e){return!e.instance&&0!==e.instance},component:function(e,t,n,i){return(0,I.jsx)(S,{field:e,data:t,setData:n,context:i.context,selectedWidgets:i.selectedWidgets,selectedView:i.selectedView})}},{label:"read_only",name:"readOnly",type:"checkbox",default:!1},{label:"hide_days_of_week",name:"hideDow",type:"checkbox",default:!1},{name:"noCard",label:"without_card",type:"checkbox",hidden:"!!data.externalDialog"},{name:"widgetTitle",label:"name",hidden:"!!data.noCard"}]}],visDefaultStyle:{width:"100%",height:355,position:"relative"},visPrev:"widgets/scheduler/img/prev_scheduler.png"}}},{key:"t",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return j.I18n.t.apply(j.I18n,["scheduler_".concat(e)].concat(n))}}]),n}(window.visRxWidget||k.VisRxWidget);_.propTypes={context:v().object,themeType:v().string,style:v().object,data:v().object},t.default=(0,b.withStyles)((function(){return{content:{display:"flex",width:"100%",height:"100%",position:"relative"}}}))((0,b.withTheme)(_))}}]);
//# sourceMappingURL=src_Scheduler_jsx.7da9831d.chunk.js.map