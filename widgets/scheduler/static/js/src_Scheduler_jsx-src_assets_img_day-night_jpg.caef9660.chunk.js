"use strict";(self.webpackChunkiobroker_vis_2_widgets_scheduler=self.webpackChunkiobroker_vis_2_widgets_scheduler||[]).push([["src_Scheduler_jsx-src_assets_img_day-night_jpg"],{475:function(t,e,i){i.r(e),i.d(e,{default:function(){return G}});var n=i(4165),r=i(5861),a=i(5671),s=i(3144),o=i(1752),l=i(1120),d=i(136),c=i(7277),h=i(4942),u=i(1413),p=i(8997),f=i(4819),m=i.n(f),v=i(5854),x=i.n(v),g=i(4427),y=i(9665),b=i(5975),w=i.p+"static/media/day-night.d6f09cbf18746b70d451.jpg",k=i(184),S={dayNightCont:{position:"relative",width:"100%",display:"flex",justifyContent:"center",overflow:"hidden",transition:"height 300ms ease-out","&>div":{position:"relative"},"&>div>.day_night":{width:"100%",maxWidth:550,maxHeight:90},"&>div>img":{width:"100%",maxWidth:550,height:"auto",maxHeight:90}},dayNightQuarter:{display:"flex",width:"100%"},dayNightSlide:{display:"flex",width:"100%",height:"calc(100% - 9px)",position:"absolute",border:"6px solid #FFF",mt:"-3px",transition:"all 400ms ease-out","&::before":{content:'""',position:"absolute",left:"calc(-200% - 5px)",top:-5,height:"calc(100% + 12px)",width:"200%",pointerEvents:"none",background:"linear-gradient(to left,  rgba(255,255,255,1) 0%,rgba(255,255,255,0) 99%,rgba(255,255,255,0) 100%)",filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#00ffffff',GradientType=0)"},"&::after":{content:'""',position:"absolute",right:"calc(-200% - 5px)",top:-5,height:"calc(100% + 12px)",width:"200%",pointerEvents:"none",background:"linear-gradient(to right,  rgba(255,255,255,1) 0%,rgba(255,255,255,0) 99%,rgba(255,255,255,0) 100%)",filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff', endColorstr='#00ffffff',GradientType=0)"}},dn:{width:"100%",maxWidth:550,maxHeight:90,height:"100%",position:"absolute",top:0,left:0,display:"flex"}},j=function(t){(0,d.Z)(i,t);var e=(0,c.Z)(i);function i(){var t;(0,a.Z)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(t=e.call.apply(e,[this].concat(r))).onSlide=function(e){t.props.onChange&&t.props.onChange(e)},t}return(0,s.Z)(i,[{key:"render",value:function(){var t=this,e=this.props.sections,i=1===e?0:78,n=100/e,r=Array(e).fill().map((function(e,i){return(0,k.jsx)("div",{style:S.dayNightQuarter,onClick:function(){return t.onSlide(i)}},i)}));return(0,k.jsx)(g.Box,{sx:S.dayNightCont,style:{height:i},children:(0,k.jsxs)("div",{children:[(0,k.jsx)("img",{src:w,alt:"day-night",id:"".concat(this.props.id,"-day-night")}),(0,k.jsxs)("div",{style:S.dn,children:[r,(0,k.jsx)(g.Box,{sx:S.dayNightSlide,style:{maxWidth:"".concat(n,"%"),width:"".concat(n,"%"),left:"calc(".concat(this.props.quarterId*n,"% - 5px)")}})]})]})})}}]),i}(f.Component),C=j,W=JSON.parse('{"temperature":{"min":0,"max":28,"step":0.5,"unit":"\xb0"},"percent":{"min":0,"max":100,"unit":"%"},"onoff":{"min":0,"max":1}}'),I={pretty:function(t){return{position:"relative",height:"100%",display:"flex",flexDirection:"column",width:t}},prettyLabel:{color:"#6c7a93",fontWeight:700,fontSize:".9rem",height:30,width:"calc(100% - 5px)",textAlign:"center"},prettyTime:{position:"absolute",fontSize:"0.9rem",fontWeight:700,bottom:27,width:"calc(100% - 5px)",borderRadius:"4px",height:28,maxHeight:28,minHeight:28,display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer"},active:function(t){return{backgroundColor:t.palette.primary.light,color:"#FFF"}},prettySecs:function(t){return{fontSize:"0.6rem",fontWeight:100,color:t.palette.text.primary}},tooltip:{pointerEvents:"none"}},M={root:function(t,e){return{color:t.palette.primary.light,borderRadius:0,transition:"all 100ms ease-out",position:"relative",width:"".concat(e,"px"),p:0,height:"calc(100% - 90px)"}},thumb:function(t){return{left:"50%",width:0,height:0,display:"onoff"===t?"none":"flex"}},active:{backgroundColor:"transparent",width:0,height:0},valueLabel:function(t,e){return{position:"relative",left:"unset",right:"unset",textAlign:"center",transform:"none !important",background:"transparent",userSelect:"none","& *":{userSelect:"none",background:"transparent",fontWeight:100,color:t.palette.text.primary,fontSize:e?"".concat(e,"px"):"1.0rem",transition:"all 100ms ease-out"}}},valueLabelCircle:{background:"transparent"},track:{transition:"all 100ms ease-out",borderRadius:"4px",width:"calc(100% - 8px)"},rail:function(t){return{transition:"all 100ms ease-out",borderRadius:"4px",height:"calc(100% + 5px)",mt:"-5px",backgroundColor:t.palette.primary.light,width:"calc(100% - 5px)",borderBottomLeftRadius:0,borderBottomRightRadius:0}}};function D(t){var e=(D.canvas||(D.canvas=document.createElement("canvas"))).getContext("2d");return e.font="normal 1rem Roboto, Helvetica, Arial, sans-serif",e.measureText(t).width}var O=function(t){var e=(0,u.Z)({},t),i=e.intervalsWidth;delete e.intervalsWidth,delete e.type,delete e.theme;var n,r=D(t.valueLabelFormat);return r>i&&(n=Math.floor(i/r*13)),(0,k.jsx)(g.Slider,(0,u.Z)({id:t.id,sx:{"&.MuiSlider-root":M.root(t.theme,i),"& .MuiSlider-thumb":M.thumb(t.type),"& .MuiSlider-active":M.active,"& .MuiSlider-valueLabel":M.valueLabel(t.theme,n),"& .MuiSlider-valueLabelCircle":M.valueLabelCircle,"& .MuiSlider-track":M.track,"& .MuiSlider-rail":M.rail(t.theme)}},e))},Z=function(t){(0,d.Z)(i,t);var e=(0,c.Z)(i);function i(t){var n;return(0,a.Z)(this,i),(n=e.call(this,t)).handleSliderChange=function(t,e){t.shiftKey||n.on("data",e)},n.handleSelected=function(t){t.shiftKey||n.on("selected",!n.props.selected)},n.on=function(t,e){return n.props.on&&n.props.on(t,e,n.props.i)},n.getLabel=function(){var t=n.props,e=t.step,i=t.i*e;return[parseInt(i),"0".concat(i%1*60).slice(-2)]},n.state={intervalsWidth:t.intervalsWidth},n.installed=!1,n}return(0,s.Z)(i,[{key:"componentDidMount",value:function(){this.installHandlers()}},{key:"componentWillUnmount",value:function(){var t=window.document.getElementById("slider_".concat(this.props.i,"_").concat(this.props.id));t&&(t.onmousemove=null)}},{key:"installHandlers",value:function(){var t=window.document.getElementById("slider_".concat(this.props.i,"_").concat(this.props.id));t&&!this.installed&&(this.installed=!0,t._interval=this,t.onmousemove=function(t){var e;if((t.buttons||null!==(e=t.touches)&&void 0!==e&&e.length)&&t.shiftKey){var i,n,r=this._interval,a=this.getBoundingClientRect().height;n=null!==(i=t.touches)&&void 0!==i&&i.length?t.touches[0].clientY-this.getBoundingClientRect().top:t.clientY-this.getBoundingClientRect().top;var s,o=r.getMinMax(),l=o.min,d=o.max;switch(r.props.type){case"temperature":s=n/a,s=l+Math.round((d-l)*(1-s)*2)/2,s=Math.min(d,Math.max(l,s));break;case"onoff":s=Math.round(n/a*100)<50;break;case"custom":s=n/a,s=l+Math.round((d-l)*(1-s)),s=Math.min(d,Math.max(l,s));break;default:s=100-(s=Math.round(n/a*100)),s=Math.min(100,Math.max(0,s))}r.props.on("data",s,r.props.i)}})}},{key:"componentDidUpdate",value:function(t){this.installHandlers(),t.intervalsWidth!==this.props.intervalsWidth&&this.setState({intervalsWidth:this.props.intervalsWidth})}},{key:"getPostfix",value:function(t){switch(this.props.type){case"onoff":return t?(0,k.jsx)("span",{style:this.props.theme.palette.text.success,children:this.props.onText}):(0,k.jsx)("span",{style:this.props.theme.palette.text.danger,children:this.props.offText});case"custom":return this.props.minMax.marks&&void 0!==this.props.minMax.marks[t]?this.props.minMax.marks[t].toString():this.props.minMax.unit?t.toString()+this.props.minMax.unit:t.toString();default:return t.toString()+this.props.minMax.unit}}},{key:"getMinMax",value:function(){return"custom"===this.props.type?this.props.minMax:W[this.props.type]||{min:0,max:100}}},{key:"render",value:function(){var t=this,e=this.props,i=e.value,n=e.i,r=e.selected,a=e.theme,s=e.type,o=this.state.intervalsWidth;if(n<0)return"";var l=this.getMinMax(),d=l.min,c=l.max,h=l.step;console.log("min",d,"max",c,"step",h);var p=this.getLabel(),f=i||0,m="onoff"===s?this.getPostfix(f||0):"",v="onoff"!==s?this.getPostfix(f||0):"";return(0,k.jsx)(g.Tooltip,{title:this.props.t('Press "shift" and move mouse to change more than one slider'),componentsProps:{popper:{sx:I.tooltip}},children:(0,k.jsxs)("span",{style:I.pretty(o),children:[(0,k.jsx)("span",{style:I.prettyLabel,children:m}),(0,k.jsx)(O,{ref:this.ref,theme:a,intervalsWidth:o,type:s,orientation:"vertical","aria-label":"pretty slider",value:f,valueLabelFormat:v,min:d,max:c,step:h||1,selected:r,onChange:this.handleSliderChange,valueLabelDisplay:"on",id:"slider_".concat(this.props.i,"_").concat(this.props.id)},n),(0,k.jsxs)(g.Box,{sx:r?I.active:void 0,onClick:this.handleSelected,onMouseMove:function(e){e.shiftKey&&e.buttons&&t.on("selected",window.myselectMode)},onMouseDown:function(e){e.shiftKey&&(window.myselectMode=!t.props.selected,t.on("selected",!t.props.selected))},style:(0,u.Z)((0,u.Z)({},I.prettyTime),{},{userSelect:"none"}),children:[(0,k.jsx)("span",{style:{color:this.props.theme.palette.text.primary},children:p[0]}),(0,k.jsx)(g.Box,{component:"span",sx:I.prettySecs,children:p[1]})]})]})})}}]),i}(f.Component),T={swiperContent:{width:"100%",height:"100%",display:"flex",justifyContent:"space-between","@media (max-width:570px)":{justifyContent:"center"}},swiper:{width:"100%",height:"100%",display:"flex",alignItems:"center",marginTop:15,position:"relative"},timeLineContainer:{position:"absolute",height:"100%"},timeLine:function(t){return{zIndex:100,borderWidth:2,borderColor:t.palette.text.primary,borderLeftStyle:"dashed",width:4,height:"calc(100% - 20px)",position:"relative"}}},R=function(t){(0,d.Z)(i,t);var e=(0,c.Z)(i);function i(t){var n;return(0,a.Z)(this,i),(n=e.call(this,t)).timeInterval=null,n.setSlideInterval=null,n.getNumberOfSectionsByRange=function(t){if(n.state.intervalsWidth>=720)return.25===t?4:.5===t?2:1;switch(t){case.25:return 16;case.5:return 8;case 1:return 4;case 2:return 3;case 4:return 1;default:return 2}},n.getCountByRange=function(t,e){if((e=e||n.state.intervalsWidth)>=720)return.5===t||.25===t?24:i.getMaxByRange(t);switch(t){case.25:case.5:case 1:case 4:return 6;default:return 4}},n.setSlideId=function(t){n.setState({slideId:parseInt(t)})},n.onChange=function(t,e,i){var r=n.state.selected,a=JSON.parse(JSON.stringify(n.state));if("selected"===t)a[t][i]=e,n.setState(a);else if("data"===t){var s=JSON.parse(JSON.stringify(n.props.data)),o=r[i];o||n.setState({selected:[]}),o&&0!==r.filter((function(t){return t})).length?s.forEach((function(t,i){r[i]&&(s[i]=e)})):s[i]=e,n.props.onChange(s)}},n.state={slideId:0,selected:[],intervalsWidth:t.intervalsWidth,key:parseInt(Date.now()+1e3*Math.random()),currentTime:new Date},n.onText=t.t("on"),n.offText=t.t("off"),n}return(0,s.Z)(i,[{key:"componentDidMount",value:function(){var t=this;this.setSlideOfTime(),this.timeInterval=setInterval((function(){return t.setState({currentTime:new Date})}),12e4),this.setSlideInterval=setInterval((function(){return t.setSlideOfTime()}),12e4)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timeInterval),this.timeInterval=null,clearInterval(this.setSlideInterval),this.setSlideInterval=null}},{key:"componentDidUpdate",value:function(t){t.range!==this.props.range&&(this.setState({slideId:0}),this.setSlideOfTime()),this.props.intervalsWidth&&t.intervalsWidth!==this.props.intervalsWidth&&this.setState({intervalsWidth:this.props.intervalsWidth,key:parseInt(Date.now()+1e3*Math.random()),slideId:this.getSlideOfTime(t.intervalsWidth)})}},{key:"getSlide",value:function(){var t=this,e=this.state,n=e.intervalsWidth,r=e.slideId,a=e.selected,s=e.key,o=this.props,l=o.type,d=o.theme,c=o.range,h=o.data,u=o.minMax,p=this.getCountByRange(c);if(r*p>=i.getMaxByRange(c))return setTimeout((function(){t.setSlideOfTime()}),50),null;for(var f=[],m=r*p;m<(r+1)*p;m++)f.push((0,k.jsx)(Z,{value:h[m],selected:a[m],label:"",i:m,id:this.props.id,step:c,on:this.onChange,type:l,theme:d,intervalsWidth:n/p,minMax:u,onText:this.onText,offText:this.offText,t:this.props.t},"".concat(m,"step").concat(c).concat(s)));var v=new Date(this.state.currentTime),x=Math.round(((v.getHours()+v.getMinutes()/60)/c-p*r)/p*n);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{style:T.timeLineContainer,title:this.props.t("Now"),children:(0,k.jsx)(g.Box,{sx:T.timeLine,style:{left:x}})}),f]})}},{key:"getSlideOfTime",value:function(t){var e=this.props.range;if(t=t||this.state.intervalsWidth){var i=(new Date).getHours(),n=this.getCountByRange(e,t)*e;return Math.floor(i/n)}return 0}},{key:"setSlideOfTime",value:function(){this.state.intervalsWidth&&this.setState({slideId:this.getSlideOfTime()})}},{key:"render",value:function(){var t=this;if(!this.state.intervalsWidth)return null;var e=this.state.slideId,i=this.props.range,n=this.getNumberOfSectionsByRange(i);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(g.Box,{sx:T.swiperContent,children:(0,k.jsx)("div",{style:T.swiper,children:this.getSlide()})}),(0,k.jsx)(C,{id:this.props.id,sections:n,quarterId:parseInt(e),onChange:function(e){t.setSlideId(e),clearInterval(t.setSlideInterval),t.setSlideInterval=setInterval((function(){return t.setSlideOfTime()}),12e4)}})]})}}]),i}(f.Component);R.getMaxByRange=function(t){return 24/t};var _=R,L={tapperGrid:{margin:0,boxShadow:"none",borderRadius:0,alignItems:"center",p:"10px","@media (max-width:570px)":{margin:0,boxShadow:"none",borderRadius:0,alignItems:"center",padding:"0px 10px 0 60px"}},tapperInside:{overflow:"hidden",height:"100%",flexGrow:1,position:"relative",display:"flex",flexDirection:"column",justifyContent:"center"}},B=function(t){(0,d.Z)(i,t);var e=(0,c.Z)(i);function i(t){var n;return(0,a.Z)(this,i),(n=e.call(this,t)).updateWindowDimensions=function(){var t,e=null===(t=n.tapperRef.current)||void 0===t?void 0:t.getBoundingClientRect().width;n.setState({intervalsWidth:e||30})},n.tapperRef=m().createRef(),n.state={intervalsWidth:0},n}return(0,s.Z)(i,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.updateWindowDimensions),this.updateWindowDimensions()}},{key:"componentDidUpdate",value:function(t){t.range!==this.props.range&&this.updateWindowDimensions(),t.windowWidth!==this.props.windowWidth&&this.updateWindowDimensions()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions)}},{key:"render",value:function(){var t,e=this,i=this.props,n=i.type,r=i.theme,a=i.range,s=i.intervals,o=i.minMax,l=null===(t=this.tapperRef.current)||void 0===t?void 0:t.getBoundingClientRect().width;return l&&l!==this.state.intervalsWidth&&(this.updateWidth=this.updateWidth||setTimeout((function(){e.updateWidth=null,e.updateWindowDimensions()}),100)),(0,k.jsx)(g.Box,{className:"m-1 h-100",sx:L.tapperGrid,style:{backgroundColor:r.palette.background.default,padding:0},children:(0,k.jsx)("div",{id:"".concat(this.props.id,"-tapper-inside"),ref:this.tapperRef,style:(0,u.Z)((0,u.Z)({},L.tapperInside),{},{padding:0,width:"100%"}),children:this.props.intervalsWidth||this.state.intervalsWidth?(0,k.jsx)(_,{id:this.props.id,data:s,onChange:this.props.onChange,theme:r,type:n,range:a,intervalsWidth:this.props.intervalsWidth||this.state.intervalsWidth,minMax:o,t:this.props.t}):null})})}}]),i}(f.Component),N=["Su","Mo","Tu","We","Th","Fr","Sa"],P=[1,2,3,4,5,6,0],F=[0,1,2,3,4,5,6],H={flow:{width:26,height:28,maxHeight:28,minHeight:28,padding:0,display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",position:"relative"},label:function(t){return{color:t.palette.text.primary,ml:0,mr:"12px"}}},J=function(t){(0,d.Z)(i,t);var e=(0,c.Z)(i);function i(){return(0,a.Z)(this,i),e.apply(this,arguments)}return(0,s.Z)(i,[{key:"render",value:function(){var t=this,e="monday"===this.props.firstDayOfWeek?P:F;return(0,k.jsxs)(g.FormControl,{component:"fieldset",style:{marginRight:12},children:[e.map((function(e){return(0,k.jsx)(g.FormControlLabel,{style:{marginLeft:6},control:(0,k.jsx)(g.Checkbox,{checked:t.props.dow.includes(e),color:"primary",style:H.flow,onChange:function(i){return t.props.onChange(e,i.target.checked)}}),label:t.props.t(N[e]),sx:H.label},e)})),this.props.holidayVisible?(0,k.jsx)(g.FormControlLabel,{style:{marginLeft:6},control:(0,k.jsx)(g.Checkbox,{checked:!!this.props.holiday,color:"primary",style:H.flow,onChange:function(e){return t.props.onChange("holiday",e.target.checked)}}),label:this.props.t("Holiday"),sx:H.label}):null]})}}]),i}(f.Component),U=J,E={content:{display:"flex",width:"100%",height:"100%",position:"relative"}},A=function(t){var e=(0,f.useState)(null),i=(0,p.Z)(e,2),n=i[0],r=i[1];if((0,f.useEffect)((function(){t.context.socket.getObject("system.adapter.scheduler.".concat(t.data.instance)).then((function(t){return r(t)}))}),[]),!n)return null;var a=[];return function t(e,i){e.forEach((function(e){a.push({profile:e,level:i}),n.native.profiles.filter((function(t){return t.parent===e.id})).length&&t(n.native.profiles.filter((function(t){return t.parent===e.id})),i+1)}))}(n.native.profiles.filter((function(t){return!t.parent})),0),console.log(a),(0,k.jsx)(g.Select,{style:{width:"100%"},value:t.data[t.field.name],onChange:function(e){var i=(0,u.Z)((0,u.Z)({},t.data),{},(0,h.Z)({},t.field.name,e.target.value)),n=a.find((function(e){return e.profile.id===t.data[t.field.name]})),r=a.find((function(t){return t.profile.id===e.target.value}));r&&(!i.name||n&&t.data.name===n.profile.title)&&(i.name=r.profile.title),t.setData(i)},variant:"standard",renderValue:function(t){var e=a.find((function(e){return e.profile.id===t}));return(0,k.jsx)("div",{children:e?e.profile.title:""})},children:a.map((function(t){return(0,k.jsx)(g.MenuItem,{value:t.profile.id,disabled:"folder"===t.profile.type,children:(0,k.jsxs)("div",{style:{paddingLeft:20*t.level,display:"flex"},children:[(0,k.jsx)("span",{style:{paddingRight:4},children:"folder"===t.profile.type?(0,k.jsx)(b.IconClosed,{}):(0,k.jsx)(y.Schedule,{})}),t.profile.title]})},t.profile.id)}))})},z=function(t){(0,d.Z)(i,t);var e=(0,c.Z)(i);function i(t){var s;return(0,a.Z)(this,i),(s=e.call(this,t)).onProfileChanged=function(t,e){if(t===s.state.object._id){var i,n,r=s.state.object.native.profiles.find((function(t){return t.id===s.state.rxData.profile})),a=null===(i=e.native)||void 0===i||null===(n=i.profiles)||void 0===n?void 0:n.find((function(t){return t.id===s.state.rxData.profile}));JSON.stringify(r)!==JSON.stringify(a)&&s.setState({object:e})}},s.onDow=function(t,e){var i=JSON.parse(JSON.stringify(s.currentProfile()));"holiday"===t?i.holiday=e:e&&!i.dow.includes(t)?i.dow.push(t):!e&&i.dow.includes(t)&&i.dow.splice(i.dow.indexOf(t),1),s.changeProfile(i)},s.onIntervals=function(t){var e=JSON.parse(JSON.stringify(s.currentProfile()));e.intervals=t,s.changeProfile(e)},s.changeProfile=function(t){if(!s.state.rxData.readOnly){var e=JSON.parse(JSON.stringify(s.state.object)),i=s.state.object.native.profiles.findIndex((function(t){return t.id===s.state.rxData.profile}));e.native.profiles[i].data=t,s.setState({object:e}),s.writeTimeout?clearTimeout(s.writeTimeout):s.setState({writing:!0}),s.writeTimeout=setTimeout(function(){var t=(0,r.Z)((0,n.Z)().mark((function t(e){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.writeTimeout=null,t.next=3,s.props.context.socket.setObject(e._id,e);case 3:s.setState({writing:!1});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),2e3,e)}},s.currentProfile=function(){var t=s.state.object.native.profiles.find((function(t){return t.id===s.state.rxData.profile}));return t?"profile"===t.type&&t.data:null},s.widgetRef=m().createRef(),s}return(0,s.Z)(i,[{key:"propertiesUpdate",value:function(){var t=(0,r.Z)((0,n.Z)().mark((function t(){var e,i,r,a,s,o,l,d,c,h=this;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.state.rxData.instance||0===this.state.rxData.instance?"system.adapter.scheduler.".concat(this.state.rxData.instance):"",this.subscribedId===e){t.next=30;break}if(this.subscribedId&&this.props.context.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged),this.subscribedId=e,!this.subscribedId){t.next=27;break}return t.next=7,this.props.context.socket.getObject(this.subscribedId);case 7:if(i=t.sent,r=i.native.profiles.find((function(t){return t.id===h.state.rxData.profile})),a={object:i},!r){t.next=22;break}if((s="custom"===r.data.type?r.data.members[0]:"")===this.minMaxObjectId){t.next=22;break}if(this.minMaxObjectId=s,!this.minMaxObjectId){t.next=20;break}return t.next=17,this.props.context.socket.getObject(this.minMaxObjectId);case 17:o=t.sent,t.next=21;break;case 20:o=null;case 21:a.minMaxObject=o;case 22:return t.next=24,this.props.context.socket.subscribeObject(this.subscribedId,this.onProfileChanged);case 24:this.setState(a),t.next=28;break;case 27:this.setState({object:null});case 28:t.next=43;break;case 30:if(!this.state.object||!this.state.rxData.profile){t.next=43;break}if(l=this.state.object.native.profiles.find((function(t){return t.id===h.state.rxData.profile})),(d="custom"===l.data.type||"temperature"===l.data.type?l.data.members[0]:"")===this.minMaxObjectId){t.next=43;break}if(this.minMaxObjectId=d,!this.minMaxObjectId){t.next=41;break}return t.next=38,this.props.context.socket.getObject(this.minMaxObjectId);case 38:c=t.sent,t.next=42;break;case 41:c=null;case 42:this.setState({minMaxObject:c});case 43:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){(0,o.Z)((0,l.Z)(i.prototype),"componentDidMount",this).call(this),this.propertiesUpdate()}},{key:"componentWillUnmount",value:function(){(0,o.Z)((0,l.Z)(i.prototype),"componentWillUnmount",this).call(this),this.subscribedId&&this.props.context.socket.unsubscribeObject(this.subscribedId,this.onProfileChanged)}},{key:"onRxDataChanged",value:function(){this.propertiesUpdate()}},{key:"getWidgetInfo",value:function(){return i.getWidgetInfo()}},{key:"getProfileMinMax",value:function(t){if("custom"===t.type){var e,i,n=this.state.minMaxObject;if("number"===(null===n||void 0===n||null===(e=n.common)||void 0===e?void 0:e.type)){if(n.common.states&&!Array.isArray(n.common.states)){var r=Object.keys(n.common.states).map((function(t){return parseFloat(t)})).sort();return{min:r[0],max:r[r.length-1],unit:n.common.unit,marks:n.common.states}}if(void 0!==n.common.min||void 0!==n.common.max)return{min:void 0!==n.common.min?n.common.min:0,max:void 0!==n.common.max?n.common.max:100,unit:n.common.unit,marks:null}}return{min:0,max:100,marks:null,unit:null===n||void 0===n||null===(i=n.common)||void 0===i?void 0:i.unit}}if("temperature"===t.type){var a=this.state.minMaxObject;if(null!==a&&void 0!==a&&a.common&&(void 0!==a.common.min||void 0!==a.common.max))return{min:void 0!==a.common.min?a.common.min:W.temperature.min,max:void 0!==a.common.max?a.common.max:W.temperature.max,unit:a.common.unit||W[t.type].unit,marks:null}}return{min:W[t.type].min,max:W[t.type].max,step:W[t.type].step,marks:null,unit:W[t.type].unit}}},{key:"renderWidgetBody",value:function(t){var e,n,r=this;if((0,o.Z)((0,l.Z)(i.prototype),"renderWidgetBody",this).call(this,t),!this.state.rxData.instance)return(0,k.jsx)("div",{children:i.t("instance_not_selected")});if(!this.state.object)return null;console.log(this.state.object);var a=this.currentProfile();if(!a)return(0,k.jsx)("div",{children:i.t("profile_not_selected")});null!==(e=this.widgetRef.current)&&void 0!==e&&e.offsetWidth||setTimeout((function(){return r.forceUpdate()}),100);var s=((null===(n=this.widgetRef.current)||void 0===n?void 0:n.offsetWidth)||0)-(this.state.rxData.hideDow?0:80);s<0&&(s=0);var d=(0,k.jsxs)("div",{style:E.content,ref:this.widgetRef,children:[this.state.writing?(0,k.jsx)(g.LinearProgress,{style:{position:"absolute",zIndex:1,top:0,left:0,width:"100%"}}):null,s?(0,k.jsx)(B,{id:this.props.id,onChange:this.onIntervals,theme:this.props.context.theme,intervals:a.intervals,range:a.intervalDuration,type:a.type,socket:this.props.context.socket,windowWidth:s,readOnly:this.state.rxData.readOnly,intervalsWidth:s,minMax:this.getProfileMinMax(a),t:i.t}):null,this.state.rxData.hideDow&&s?null:(0,k.jsx)(U,{firstDayOfWeek:this.props.context.socket.systemConfig.common.firstDayOfWeek||"monday",readOnly:this.state.rxData.readOnly,dow:a.dow,holiday:a.holiday,holidayVisible:!!this.state.object.native.holidayId,onChange:this.onDow,theme:this.props.context.theme,t:i.t})]});return this.state.rxData.noCard||t.widget.usedInWidget?d:this.wrapContent(d,null,{height:"calc(100% - 24px)",width:"calc(100% - 50px)"})}}],[{key:"getWidgetInfo",value:function(){return{id:"tplScheduler",visSet:"scheduler",visWidgetLabel:"scheduler",visSetLabel:"set_label",visSetColor:"#70BBF7",visName:"Scheduler",visAttrs:[{name:"common",fields:[{label:"instance",name:"instance",type:"instance",adapter:"scheduler",isShort:!0},{label:"profile",name:"profile",type:"custom",hidden:function(t){return!t.instance&&0!==t.instance},component:function(t,e,i,n){return(0,k.jsx)(A,{field:t,data:e,setData:i,context:n.context,selectedWidgets:n.selectedWidgets,selectedView:n.selectedView})}},{label:"read_only",name:"readOnly",type:"checkbox",default:!1},{label:"hide_days_of_week",name:"hideDow",type:"checkbox",default:!1},{name:"noCard",label:"without_card",type:"checkbox",hidden:"!!data.externalDialog"},{name:"widgetTitle",label:"name",hidden:"!!data.noCard"}]}],visDefaultStyle:{width:"100%",height:355,position:"relative"},visPrev:"widgets/scheduler/img/prev_scheduler.png"}}},{key:"t",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return b.I18n.t.apply(b.I18n,["scheduler_".concat(t)].concat(i))}}]),i}(window.visRxWidget);z.propTypes={context:x().object,themeType:x().string,style:x().object,data:x().object};var G=z}}]);
//# sourceMappingURL=src_Scheduler_jsx-src_assets_img_day-night_jpg.caef9660.chunk.js.map